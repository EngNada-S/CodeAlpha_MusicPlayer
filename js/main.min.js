const navBtns=document.querySelectorAll("nav button"),sections=document.querySelectorAll(".main section"),addSongBtn=document.getElementById("addSongBtn"),songFile=document.getElementById("songFile"),empty=document.querySelector(".empty"),songsList=document.querySelector(".songs-list"),favoritesList=document.querySelector(".favorites-list"),player=document.querySelector(".player-container"),playerTitle=player.querySelector(".player-song-info h3"),playerArtist=player.querySelector(".player-song-info p"),currentTimeEle=player.querySelector(".current-time"),totalTimeEle=player.querySelector(".total-time"),songCover=document.querySelector(".song-cover"),downPlayer=document.getElementById("downPlayer"),volumeContainer=document.querySelector(".volume"),showVolumeBtn=document.getElementById("controlVolume"),volumeBar=document.getElementById("volumeBar"),progressInput=document.querySelector(".progress-bar input"),randomSongBtn=document.getElementById("randomSong"),previousSongBtn=document.getElementById("previousSong"),playPauseBtn=document.getElementById("pauseSong"),nextSongBtn=document.getElementById("nextSong"),repeatBtn=document.getElementById("repeatSong"),summary=document.querySelector(".summary"),summaryCover=document.getElementById("summaryCover"),summaryTitle=document.getElementById("summaryTitle"),summaryArtist=document.getElementById("summaryArtist"),summaryPlayPauseBtn=document.getElementById("summaryPauseSong"),searchInput=document.getElementById("findSong"),searchList=document.querySelector(".search-list");let allSongs=[],currentIndex=0,isRepeatOn=!1,currentTimeListener=null;function formatDuration(e){let t=Math.floor(e%60);return`${Math.floor(e/60)}:${t<10?"0":""}${t}`}function setUpProgressBar(e){progressInput.value=Math.floor(e)}function updateBarBg(e,t,n="var(--main-color)"){e.style.background=`linear-gradient(to right, ${n} ${t}%, rgba(255,255,255,0.1) ${t}%)`}function displaySongs(e,t){t.innerHTML="",e.forEach(e=>{let n=document.createElement("li");n.classList.add("song"),n.classList.toggle("playing",e.playing),n.innerHTML=`
      <div class="song-info" title="${e.songName}">
        <img src="${e.cover}" alt="cover">
      <div>
      <div class="song-name">${e.songName}</div>
        <small>${e.artist}</small>
        <div class="song-duration">${e.duration?formatDuration(e.duration):"..."}</div>
      </div>
      <button class="favorite-btn">${e.fav?'<i class="fa-solid fa-heart"></i>':'<i class="fa-regular fa-heart"></i>'}</button>
          <button class="delete-btn"><i class="fa-solid fa-x"></i></button>
      </div>
      `,n.querySelector(".favorite-btn").addEventListener("click",t=>{t.stopPropagation(),e.fav=!e.fav,refreshUI(),updateSearchResults()}),n.querySelector(".delete-btn").addEventListener("click",t=>deleteSong(t,e)),n.addEventListener("click",()=>openSong(e.id)),t.appendChild(n)})}function refreshUI(){displaySongs(allSongs,songsList),displaySongs(allSongs.filter(e=>e.fav),favoritesList)}function updateUI(e){updatePlayerUI(e),updateSummaryUI(e),updatePlayPauseIcons(e)}function openSong(e){let t=allSongs.find(t=>t.id===e);t&&(stopAllSongs(),currentIndex=allSongs.indexOf(t),t.audio.play(),t.playing=!0,t.audio.volume=parseFloat(volumeBar.value),player.classList.add("open"),updateUI(t),updateSummaryVisibility(),refreshUI(),currentTimeListener=()=>{let e=t.audio.currentTime;currentTimeEle.textContent=formatDuration(e);let n=t.duration>0?e/t.duration*100:0;updateBarBg(progressInput,n),setUpProgressBar(n)},t.audio.addEventListener("timeupdate",currentTimeListener),t.audio.addEventListener("ended",handleSongEnd))}function stopAllSongs(){allSongs.forEach(e=>{e.playing&&e.audio&&currentTimeListener&&e.audio.removeEventListener("timeupdate",currentTimeListener),e.audio.pause(),e.playing=!1,e.audio.currentTime=0}),refreshUI()}function handleSongEnd(){isRepeatOn?(allSongs[currentIndex].audio.currentTime=0,allSongs[currentIndex].audio.play()):currentIndex<allSongs.length-1?nextSong():togglePlayPause()}function togglePlayPause(){let e=allSongs[currentIndex];e&&(e.playing?(e.audio.pause(),e.playing=!1,songCover.style.animationPlayState="paused"):(e.audio.play(),e.playing=!0,songCover.style.animationPlayState="running"),updatePlayPauseIcons(e),refreshUI())}function nextSong(){0!==allSongs.length&&openSong(allSongs[currentIndex=(currentIndex+1)%allSongs.length].id)}function previousSong(){0!==allSongs.length&&openSong(allSongs[currentIndex=(currentIndex-1+allSongs.length)%allSongs.length].id)}function randomSong(){0!==allSongs.length&&openSong(allSongs[currentIndex=Math.floor(Math.random()*allSongs.length)].id)}function updatePlayerUI(e){playerTitle.textContent=e.songName,playerArtist.textContent=e.artist,currentTimeEle.textContent=formatDuration(0),totalTimeEle.textContent=e.duration?formatDuration(e.duration):"0:00"}function updateSummaryUI(e){summaryCover.src=e.cover,summaryTitle.textContent=e.songName,summaryArtist.textContent=e.artist,updatePlayPauseIcons(e)}function updateSummaryVisibility(){player.classList.contains("open")?summary.classList.remove("show"):summary.classList.add("show")}function updatePlayPauseIcons(e){let t=e.playing?'<i class="fa-solid fa-pause"></i>':'<i class="fa-solid fa-play"></i>';playPauseBtn.innerHTML=t,summaryPlayPauseBtn.innerHTML=t}function deleteSong(e,t){e.stopPropagation();let n=allSongs.findIndex(e=>e.id===t.id);if(-1===n)return;let a=n===currentIndex;a&&stopAllSongs(),allSongs.splice(n,1),a?(player.classList.remove("open"),summary.classList.remove("show"),currentIndex=0,0===allSongs.length&&empty.classList.remove("hidden")):n<currentIndex&&currentIndex--,refreshUI(),updateSearchResults()}function updateSearchResults(){let e=searchInput.value.trim().toLowerCase();if(!e){searchList.innerHTML="";return}let t=allSongs.filter(t=>t.songName.toLowerCase().includes(e));displaySongs(t,searchList)}addSongBtn.addEventListener("click",()=>songFile.click()),songFile.addEventListener("change",e=>{let t=e.target.files;if(0===t.length&&0===allSongs.length){empty.classList.remove("hidden");return}empty.classList.add("hidden"),Array.from(t).forEach(e=>{let t=new Audio(URL.createObjectURL(e)),n={id:crypto.randomUUID(),songName:e.name,artist:"Unknown Artist",audio:t,fav:!1,playing:!1,cover:"images/icon.webp",duration:0};t.addEventListener("loadedmetadata",()=>n.duration=t.duration),allSongs.push(n)}),refreshUI()}),navBtns.forEach(e=>{e.addEventListener("click",function(){let e=this.dataset.sec;navBtns.forEach(e=>e.classList.remove("active")),this.classList.add("active"),sections.forEach(e=>e.classList.remove("active")),document.getElementById(e).classList.add("active")})}),downPlayer.addEventListener("click",()=>{player.classList.remove("open"),updateSummaryVisibility()}),summary.addEventListener("click",()=>{player.classList.add("open"),updateSummaryVisibility()}),playPauseBtn.addEventListener("click",togglePlayPause),summaryPlayPauseBtn.addEventListener("click",e=>{e.stopPropagation(),togglePlayPause()}),progressInput.addEventListener("input",e=>{let t=parseFloat(e.target.value);updateBarBg(progressInput,t),setUpProgressBar(t);let n=allSongs[currentIndex];n&&n.duration&&(n.audio.currentTime=t/100*n.duration)}),randomSongBtn.addEventListener("click",randomSong),previousSongBtn.addEventListener("click",previousSong),nextSongBtn.addEventListener("click",nextSong),repeatBtn.addEventListener("click",()=>{isRepeatOn=!isRepeatOn,repeatBtn.classList.toggle("active",isRepeatOn)}),showVolumeBtn.addEventListener("click",()=>volumeContainer.classList.toggle("open")),volumeBar.addEventListener("input",e=>{let t=parseFloat(e.target.value),n=100*t;updateBarBg(volumeBar,n);let a=allSongs[currentIndex];a&&a.audio&&(a.audio.volume=t)}),searchInput.addEventListener("input",updateSearchResults);